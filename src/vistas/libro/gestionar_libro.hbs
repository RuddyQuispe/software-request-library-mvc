<div class="card mx-auto bg-dark mb-3 text-light">
    <div class="card-header">
        Gestionar Libro
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-4">
                <h5 class="card-title">Registrar Libro</h5>
                <form action="/gestionar_libro" method="post">
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text" id="inputGroup-sizing-default">Autor</span>
                        </div>
                        <input type="text" class="form-control" required minlength="4" name="autor"
                            placeholder="Juancito Pinto" aria-label="Sizing example input"
                            aria-describedby="inputGroup-sizing-default">
                    </div>
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text" id="inputGroup-sizing-default">Titulo del Libro</span>
                        </div>
                        <input type="text" class="form-control" required minlength="4" name="titulo"
                            placeholder="Lo que el agua se llevó" aria-label="Sizing example input"
                            aria-describedby="inputGroup-sizing-default">
                    </div>
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text" id="inputGroup-sizing-default">Descripción</span>
                        </div>
                        <textarea name="descripcion" class="form-control" placeholder="Resumen del libro" cols="39"
                            rows="3"></textarea>
                    </div>
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text" id="inputGroup-sizing-default">Edicion del Libro</span>
                        </div>
                        <input type="text" class="form-control" required minlength="3" name="edicion"
                            aria-label="Sizing example input" aria-describedby="inputGroup-sizing-default"
                            placeholder="ej. 1ra, 3ra, 5ta, 8va, 12va">
                    </div>
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text" id="inputGroup-sizing-default">Cantidad Disponible</span>
                        </div>
                        <input type="number" class="form-control" required min="1" name="stock"
                            aria-label="Sizing example input" aria-describedby="inputGroup-sizing-default"
                            placeholder="1" value="1" min="1">
                    </div>
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text" id="inputGroup-sizing-default">Categoria</span>
                        </div>
                        <select class="form-select form-select-lg" size="3" aria-label="size 3 select example"
                            name="id_categoria">
                            <option selected>Selecciona una categoria</option>
                            {{#each lista_categorias}}
                            <option value="{{id}}">{{descripcion}}</option>
                            {{/each}}
                        </select>
                    </div>
                    <button type="submit" class="btn btn-outline-primary">Guardar Nuevo
                        Libro</button>
                </form>
            </div>
            <div class="col-md-8">
                <table class="table table-striped table-dark table-responsive">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Autor</th>
                            <th>Titulo</th>
                            <th>Edición</th>
                            <th>Stock</th>
                            <th>Estado</th>
                            <th>Categoria</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        {{#each lista_libro}}
                        <tr>
                            {{#if estado}}
                            <th class="bg-success">{{codigo}}</th>
                            {{else}}
                            <th class="bg-danger">{{codigo}}</th>
                            {{/if}}
                            <th>{{autor}}</th>
                            <th>{{titulo}}</th>
                            <th>{{edicion}}</th>
                            <th>{{stock}}</th>
                            <th>
                                {{#if estado}}
                                <form action="/gestionar_libro/habilitar_inhabilitar/{{codigo}}?_method=PUT"
                                    method="post">
                                    <input type="hidden" name="_method" value="PUT">
                                    <button type="submit" class="btn btn-outline-danger btn-sm btn-xs">
                                        inhabilitar
                                    </button>
                                </form>
                                {{else}}
                                <form action="/gestionar_libro/habilitar_inhabilitar/{{codigo}}?_method=PUT"
                                    method="post">
                                    <input type="hidden" name="_method" value="PUT">
                                    <button type="submit" class="btn btn-outline-success btn-sm btn-xs">
                                        habilitar
                                    </button>
                                </form>
                                {{/if}}
                            </th>
                            <th>{{descripcion_categoria}}</th>
                            <td>
                                <a href="/gestionar_libro/{{codigo}}" type="button"
                                    class="btn btn-outline-warning btn-sm btn-xs"><small><span class="material-icons">
                                            edit
                                        </span></small>
                                </a>
                                <button class="btn btn-outline-danger btn-sm" data-toggle="modal"
                                    data-target="#exampleModal" onclick="eliminarLibro({{codigo}})"><span
                                        class="material-icons">
                                        delete
                                    </span></button>
                            </td>
                        </tr>
                        {{/each}}
                    </tbody>
                </table>
            </div>
            <!-- Button trigger modal -->

            <!-- Modal -->
            <div class="modal fade transform-8" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel"
                aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content bg-dark text-light">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <p id="recipient-name">Esta seguro de eliminar el libro? </p>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                            <button type="button" class="btn btn-danger" onclick="confirmarEliminacion()"
                                data-dismiss="modal">Eliminar
                                Libro</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script>
    var data = {
        codigo_libro: 0
    };

    function eliminarLibro(codigoLibro) {
        data.codigo_libro = codigoLibro;
        console.log("confirmar", codigoLibro);
    }

    function confirmarEliminacion() {
        if (data.codigo_libro === undefined || data.codigo_libro === 0) {
            alert("no puedo eliminar este libro");
        } else {
            let a = axios.delete('/gestionar_libro/eliminar/' + data.codigo_libro).then(function (response) {
                document.getElementById(data.codigo_libro).remove();
            }).catch(function (error) {
                alert("Hubo un error al eliminar el libro");
            });
        }
    }

    function clickup(elemeto) {
        console.log(elemeto);
    }
</script>